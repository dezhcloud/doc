# افزودن رکوردهای DNS

زمانی که شما مقادیر NS دامنه‌ی خود را به مقادیر ارایه‌شده به‌وسیله‌ی دژ تغییر می‌دهید، سرویس  `DNS` دژ برای دامنه‌ی شما فعال می‌شود و باید تمام رکوردهای  `DNS` دامنه در پنل کاربری‌تان وارد شود تا توسط دژ Resolve و دامنه و تمام زیردامنه‌های شما بدون مشکل باز شود.

برای این کار، ابتدا به بخش دامنه‌ها رفته و برای دامنه موردنظر روی لیست رکوردها کلیک کنید. سپس در پنجره باز شده افزودن رکورد را بزنید.

<p align="center"><img src="/doc/assets/img/dns_records_add/15.png"></p>


سپس در پنجره باز‌شده افزودن رکورد را بزنید.
<p align="center"><img src="/doc/assets/img/dns_records_add/16.png"></p>

یکی از انواع رکوردها را انتخاب کرده و بر روی ادامه کلیک کنید.

<p align="center"><img src="/doc/assets/img/dns_records_add/17.png"></p>

برای افزودن رکوردهای  `DNS` لازم است با انواع و مقادیر متناسب با هر رکورد آشنا شده و شیوه‌ی افزودن آن‌ها در پنل کاربری را بدانید.


## رکوردهای A و AAAA
این رکوردها شامل نشانی  `IP` یک دامنه هستند. در این رکورد نام یک دامنه و آدرس  `IP` مرتبط با سرور فیزیکی که محتوای آن دامنه روی آن قرار دارد، ذخیره می‌شود. دقت داشته باشید که منظور از این سرور فیزیکی، سرور اصلی میزبان سایت شماست.

<p align="center"><img src="/doc/assets/img/dns_records_add/18.png"></p>


**مقدار:** در این بخش آدرس  `IP` سرور اصلی میزبان سایت شما قرار می‌گیرد.


**مدت‌ زمان اعتبار:** مشخص‌کننده‌ی مدت‌زمانی است که این رکورد می‌تواند در سرورهای‌ ابر دژ Cache (ذخیره) شود. به‌شکل پیش‌فرض این مقدار 600 ثانیه است؛ به این معنی که اگر تغییری در رکورد  `DNS` ایجاد کنید 10 دقیقه زمان می‌برد تا در همه‌ی نقاط تغییر کند.

اگر سرور اصلی میزبان سایت شما، دارای  `IPV6` باشد باید از رکورد `AAAA` استفاده کنید. تنظیم این رکورد مانند رکورد A است:

## رکورد  `CNAME`

وظیفه‌ی رکورد  `CNAME` ارسال درخواست یک نام دامنه به یک نام دامنه‌ی دیگر است. برای نمونه اگر کاربری در مرورگر خود آدرس example.com را وارد کرد درخواست آن به دامنه‌ی example1.com ارسال شود. این رکورد مستقیمن به یک آدرس  `IP` اشاره نمی‌کند.

<p align="center"><img src="/doc/assets/img/dns_records_add/18.png"></p>

برای تعریف این رکورد، در بخش مقدار نام دامنه‌ای که درخواست‌های ارسالی کاربران باید به سمت آن فرستاده شوند را وارد کنید.


## رکورد MX

این رکورد مشخص‌کننده‌ی سرور ایمیلی است که ایمیل‌های یک دامنه باید به آن ارسال شوند.

> این رکورد همیشه باید به یک نام دامنه و نه یک آدرس IP، اشاره داشته باشد.

<p align="center"><img src="/doc/assets/img/dns_records_add/19.png"></p>

برای تنظیم این رکورد، در بخش مقدار نام دامنه‌ای که سرویس ایمیل خود را از آن دریافت کرده‌اید، وارد کنید. اگر چند سرور ایمیل مختلف دارید می‌توانید چند رکورد  `MX` تعریف کرده و با استفاده از بخش اولویت، مشخص کنید که کدام ایمیل سرور، دارای اولویت بالاتری است.

ثبت رکورد  `MX` با استفاده از API:

``` yaml
curl --location --request POST 'https://napi.dezhcloud.ir/cdn/4.0/domains/example.com/dns-records' \
--header 'authority: napi.dezhcloud.ir' \
--header 'accept: application/json, text/plain, */*' \
--header 'authorization: APIKEY 1 2 3 4' \
--header 'cache-control: no-cache' \
--header 'content-type: application/json;charset=UTF-8' \
--header 'pragma: no-cache' \
--data-raw '{"type":"MX","name":"@","cloud":true,"value":{"host":"mail.example.com","priority":"10"},"upstream_https":"default","ip_filter_mode":{"count":"single","geo_filter":"none","order":"none"},"ttl":120}'
```

خروجی دستور `dig` رکورد MX:

<p align="center"><img src="/doc/assets/img/dns_records_add/digmx.png"></p>

 `Bind` Format رکورد ثبت‌شده:

``` yaml
example.com.            120     IN       `MX`      10 mail.example.com.
```

## رکورد SRV

رکورد `SRV` مشخص‌کننده‌ی هاست پشتیبانی‌کننده از یک سرویس خاص است. برای تعریف این رکورد در بخش «رکوردهای DNS»، نوع رکورد را `SRV`، عنوان را به شکل `.service._proto.example.com_@` (برای مثال: `.sip_tcp.example.com_@`)، در بخش پورت، شماره پورتی که سرویس روی آن در حال اجراست و در بخش مقدار نیز رشته‌ای به فرم `exampledomain.com` وارد کنید. هم‌چنین اگر قصد تعریف چند رکورد `SRV` را دارید، می‌توانید از بخش‌های وزن و اولویت متناسب با نیاز خود استفاده کنید.

<p align="center"><img src="/doc/assets/img/dns_records_add/20.png"></p>

رکورد `SRV` مشخص‌کننده‌ی اولویت و وزن سرورهایی است که در آن لیست شده‌اند. مقدار اولویت در یک رکورد `SRV` امکان اولویت دادن به یک سرور که از یک سرویس مشخص پشتیبانی می‌کند را نسبت به سایر سرورها فراهم می‌کند. سروری که مقدار اولویت پایین‌تری به آن تخصیص داده شده است، ترافیک بیش‌تری نسبت به دیگر سرورها دریافت می‌کند. از سوی دیگر، کارکرد وزن نیز تا اندازه‌ای مشابه است، زیرا در میان چند سرور با وزن یک‌سان، سروری که وزن بیش‌تری دارد، ترافیک بیش‌تری دریافت می‌کند.

تفاوت اصلی بین وزن و اولویت این است که در زمان عبور ترافیک، ابتدا اولویت مورد بررسی قرار می‌گیرد. اگر اولویت بین‌ سرورها متفاوت باشد، وزن در نظر گرفته نمی‌شود و ترافیک سرور با اولویت پایین‌تر را انتخاب می‌کند. زمانی که دو یا چند سرور اولویتی یکسان داشته باشند، علاوه بر اولویت، وزن نیز اهمیت پیدا می‌کند. در این زمان، پس از بررسی وزن سرورها، سروری که وزن بالاتری به آن تعلق گرفته است بیش‌ترین میزان ترافیک را دریافت خواهد کرد.

## رکورد TXT

رکورد TXT می‌تواند حاوی یک متن باشد که به دلایل مختلفی مورد استفاده قرار می‌گیرد که مهم‌ترین آن احراز هویت Mail و تعریف رکوردهای `SPF` و `DKIM` است. هنگام تعریف این رکورد، نوع رکورد را TXT قرار داده، در بخش مقدار رشته‌ای متنی را وارد کنید. اگر قصد تعریف رکوردهای `SPF` یا `DKIM` را دارید، می‌توانید از راهنماهای زیر برای شیوه‌ی تولید رشته‌ متنی متناسبی که باید در این بخش قرار گیرد، استفاده کنید:

- معرفی رکورد `SPF` و تنظیم آن در پنل کاربری ابر دژ

- معرفی رکورد `DKIM` و تنظیم آن در پنل کاربری ابر دژ
<p align="center"><img src="/doc/assets/img/dns_records_add/21.png"></p>

## رکورد CAA

رکورد `CAA` برای جلوگیری از صدور گواهی های امنیتی غیر مجاز برای یک دامنه توسعه داده شده است. با استفاده از یک رکورد  `DNS` می‌توان مشخص کرد که کدام مرجع صدور گواهینامه (CA) می‌تواند برای دامنه‌‌، یک گواهی صادر کند. این موضوع باعث افزایش سطح امنیت و یکپارچگی در سازمان می‌شود .


برای ثبت نمونه رکورد در پنل دژ پس از انتخاب دامنه از پنل کاربری، روی رکوردهای  `DNS` کلیک و یک رکورد `CAA` جدید ایجاد کنید.

<p align="center"><img src="/doc/assets/img/dns_records_add/22.png"></p>

- در قسمت تگ، رفتار  `DNS` را با رکورد مشخص کنید. این تگ سه وضعیت را معتبر می‌داند:

    * Only Allow Specific Hostnames: این حالت بیان‌کننده‌ی این است که رکورد `CAA` فقط برای یک هاست‌نیم خاص معتبر است. (هاست‌نیمی که در قسمت عنوان وارد شده است.)
    * Only Allow Wildcard: این حالت بیان‌گر اعتبار رکورد `CAA` در سطح کل دامنه است که شامل ریشه‌ی دامنه (root دامنه) و تمامی زیردامنه‌های آن می‌شود.
    * Send Violation Report in `CAA`  `DNS` Record: این ویژگی روشی را برای CAها تعیین می‌کند تا درخواست‌های گواهی نامعتبر را به صاحب دامنه گزارش کنند.

- در قسمت `CA` نام `CA` مورد نظر خود را وارد کنید برای نمونه: (letsencrypt.org)

ساخت رکورد با استفاده از API:
``` yaml
curl --location --request POST 'https://napi.dezhcloud.ir/cdn/4.0/domains/example.com/dns-records' \
--header 'authority: napi.dezhcloud.ir' \
--header 'accept: application/json, text/plain, */*' \
--header 'authorization:  `API` KEY 1 2 3 4' \
--header 'content-type: application/json;charset=UTF-8' \
--data-raw '{"type":"CAA","name":"@","cloud":true,"value":{"flag":0,"tag":"issuewild","value":"letsencrypt.org"},"upstream_https":"default","ip_filter_mode":{"count":"single","geo_filter":"none","order":"none"},"ttl":120}'
```

خروجی دستور `dig` رکورد CAA:

<p align="center"><img src="/doc/assets/img/dns_records_add/digcaa.png"></p>

نمونه ‌‌ `Bind` فرمت دستور CAA:

``` yaml
example.com.      120   IN   `CAA`   0 issuewild "letsencrypt.org" 
```
