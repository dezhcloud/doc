# توزیع بار DNS

با استفاده از قابلیت توزیع بار DNS ابر دژ می‌توانید ترافیک دامنه‌ها یا زیردامنه‌هایتان را بر اساس وزن، نوبت و منطقه‌ی جغرافیایی بین‌‌ سرورهای خود توزیع کنید.

<!---
برای فعال سازی این قابلیت پس از انتخاب دامنه از پنل کاربری، روی رکوردهای DNS کلیک و یک رکورد A جدید ایجاد کنید.

- در قسمت عنوان‌‌، ‌‌هاست‌نیم‌ (نام زیردامنه) مورد ‌نظر خود را وارد کنید. اگر رکورد مربوط به ریشه (‌‌root‌‌) دامنه است باید‌‌ در فیلد عنوان مقدار "@" و اگر مربوط به زیر دامنه‎‌ی خاصی است نام آن را وارد کنید.

- در بخش مقدار، IPهای مربوط به این زیردامنه را وارد کنید‌.

- در قسمت نوع پاسخ مشخص کنید که دژ در فرآیند تفسیر‌‌ DNS‌‌ یک IP را برگرداند یا چند IP.

- در فیلد توزیع بار نیاز است که روش این فرآیند را مشخص کنید. ترافیک می‌تواند به‌‌ ‌‌نوبت یا علاوه بر نوبت، با در نظر گرفتن وزن هر سرور بین آن‌ها توزیع شود.

> وزن، نسبت توزیع ترافیک بین دو سرور است‌‌.یعنی مقدار آن‌ها مورد توجه نیست و فقط نسبت آن‌ها مهم است. برای مثال مقادیر ‌۱ و ‌‌۲ تفاوتی با ‌‌۱۰ و ‌‌۲۰ ندارند .‌

- استراتژی توزیع بار خود را برای هر موقعیت جغرافیایی مشخص کنید. ابر دژ این امکان را به شما می‌دهد که ترافیک‌‌ خود را با توجه به منطقه‌ی جغرافیایی کاربر توزیع کنید.

> با فعال‌سازی توزیع بار بر اساس کشور، باید کشور مورد نظر را برای هر IP انتخاب کنید.

در آخر روی ذخیره کلیک کنید.‌

<p align="center"><img src="/doc/assets/img/dns_load_distribution/record.png"></p>

برای ایجاد این رکورد به کمک API می‌توانید از درخواست زیر استفاده کنید:‌

``` yaml
curl --location --request POST 
'https://napi.dezhcloud.ir/cdn/4.0/domains/example.com/dns-records' \ 
--header 'authority: napi.dezhcloud.ir' \ 
--header 'accept: application/json, text/plain, */*' \ 
--header 'authorization: APIKEY 1 2 3 4' \ 
--header 'cache-control: no-cache' \ 
--header 'content-type: application/json;charset=UTF-8' \ 
--header 'dnt: 1' \ 
--data-raw 
'{"type":"A","name":"@","cloud":false,"value":[{"country":"","ip":"192.168.1.1","port":null,"weight":"20"},{"country":"SG","ip":"192.168.1.2","port":null,"weight":"10"},{"country":"AU","ip":"192.168.1.3","port":null,"weight":"50"}],"upstream_https":"default","ip_filter_mode":{"count":"single","geo_filter":"country","order":"weighted"},"ttl":120}' 
```
-->